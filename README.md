# üì± RN Advanced Labs

Application **Expo React Native** servant de support pour tous les TP du cours.

## üìë Sommaire
- [üöÄ Pr√©requis](#-pr√©requis)
- [‚ñ∂Ô∏è Lancer l‚Äôapplication](#Ô∏è-lancer-lapplication)
- [üìÇ Structure attendue](#-structure-attendue)
- [1Ô∏è‚É£ TP1 ‚Äì Profile Card](#1Ô∏è‚É£-tp1--profile-card)
- [2Ô∏è‚É£ TP2 - Navigation](#2Ô∏è‚É£-tp2---navigation-persistance--deep-linking-avec-expo-router)
- [3Ô∏è‚É£ TP3 ‚Äì Formulaires avanc√©s (Formik vs React Hook Form)](#3Ô∏è‚É£-tp3--formulaires-avanc√©s-formik-vs-react-hook-form)
- [4Ô∏è‚É£ TP4A ‚Äì Robots (CRUD + Zustand)](#4Ô∏è‚É£-tp4a--robots-crud--zustand)
- [4Ô∏è‚É£ TP4B ‚Äì Robots (CRUD + Redux Toolkit)](#4Ô∏è‚É£-tp4b--robots-crud--redux-toolkit)
- [5Ô∏è‚É£ TP5 ‚Äì Robots (SQLite, offline)](#5Ô∏è‚É£-tp5--robots-sqlite-offline)
- [6Ô∏è‚É£ TP6 ‚Äì Cam√©ra & Galerie locale](#6Ô∏è‚É£-tp6--cam√©ra--galerie-locale)



## üöÄ Pr√©requis

- **Node.js** ‚â• 20.19.4  
- **Git**  
- **VS Code** avec extensions (*React Native Tools*, *Prettier*)  
- **Expo Go** install√© sur smartphone  

## ‚ñ∂Ô∏è Lancer l‚Äôapplication

```bash
# Installation des d√©pendances
npm install

# D√©marrage du projet Expo
npx expo start
```


## 1Ô∏è‚É£ TP1 ‚Äì Profile Card

- üìÇ **Dossier** : [app/tp1-profile-card](./app/tp1-profile-card/)
- üßæ **Description** :
  - Carte de profil avec **photo**, **nom**, **fonction**
  - Bouton **Follow/Unfollow** qui met √† jour le **compteur de followers**
  - **useEffect** : +1 follower automatiquement toutes les **5s**, avec **cleanup** du timer

**Arborescence** `app/` : 
<p align="center">
  <img src="./docs/tp1-arborescence.png" alt="Arborescence app TP1" width="220" />
</p>

---

## 2Ô∏è‚É£ TP2 - Navigation, Persistance & Deep Linking avec Expo Router

**Packages install√©s**

| Package                                 | R√¥le principal                                                                 |
|------------------------------------------|-------------------------------------------------------------------------------|
| expo, react-native, react                | Base du projet Expo React Native                                              |
| expo-router                             | Routing avanc√©, navigation par fichiers et groupes                            |
| @react-navigation/native, bottom-tabs... | Navigation (stack, tabs, etc.)                                                |
| @react-native-async-storage/async-storage| Persistance locale (sauvegarde de la route)                                   |

---

**Sch√©ma d‚Äôarborescence `app/` (groupes & √©crans)**
<p align="center">
  <img src="./docs/tp2-arborescence.png" alt="Arborescence app TP2" width="220" />
</p>

---

**Table des routes principales**

| Nom                | URL / pattern         | Param√®tres      | Description                                 |
|--------------------|----------------------|---------------|---------------------------------------------|
| Accueil            | `/`                  | -             | Page d'accueil principale                   |
| TP1 Profile Card   | `/tp1-profile-card`  | -             | TP1 en page unique                          |
| D√©tail             | `/detail/[id]`       | id (number)    | D√©tail d'un √©l√©ment, 404 si id invalide     |

---

**Sc√©narios de persistance**

Ce qui est effectivement persistant :

- **La derni√®re page visit√©e** est sauvegard√©e automatiquement √† chaque navigation dans l'application (gr√¢ce √† `AsyncStorage`).
- Lorsque l'application est ferm√©e puis relanc√©e, l'utilisateur est automatiquement redirig√© vers la derni√®re page visit√©e, m√™me apr√®s un red√©marrage complet de l'app.
- Cette persistance concerne uniquement le chemin de navigation (route), pas l'√©tat interne des √©crans (ex‚ÄØ: contenu d'un formulaire non sauvegard√©).

Choix UX r√©alis√©s :

- **Exp√©rience fluide**‚ÄØ: la restauration de la navigation est totalement transparente pour l'utilisateur, il retrouve l'√©cran o√π il s'√©tait arr√™t√© sans action manuelle.
- **Pas d'√©cran de chargement sp√©cifique**‚ÄØ: l'√©cran d'accueil (`app/index.tsx`) ne force plus de redirection, ce qui √©vite les conflits avec la restauration automatique.
- **Fallback**‚ÄØ: si aucune page n'a √©t√© sauvegard√©e (premier lancement), l'utilisateur arrive sur la page d'accueil par d√©faut.

_Impl√©mentation‚ÄØ: voir le hook `useRoutePersistence` dans `lib/nav-persistence.ts` et son int√©gration dans `app/_layout.tsx`._

**Deep linking**

- **Froid** (appli tu√©e, relanc√©e) : l'utilisateur revient sur la derni√®re page visit√©e (route restaur√©e via AsyncStorage).
- **Ti√®de** (appli en arri√®re-plan, puis reprise) : l'utilisateur reste sur la page courante (comportement natif).
- **Chaud** (navigation interne) : navigation imm√©diate, la route est sauvegard√©e √† chaque changement.

---

## 3Ô∏è‚É£ TP3 ‚Äì Formulaires avanc√©s (Formik vs React Hook Form)

**Formik VS RHF**
|                | Formik (+Yup)      | RHF (+Zod)         |
|----------------|--------------------|--------------------|
| DX             | Simple, classique  | Moderne, typ√©      |
| Perf/re-rendus | Plus de re-rendus  | Moins de re-rendus |
| Typage         | Moins strict       | Tr√®s strict        |
| Verbosit√©      | Plus de code       | Plus concis        |

Les deux‚ÄØ: validation temps r√©el, erreurs contextuelles, bouton d√©sactiv√© si invalide, focus auto, haptique, reset apr√®s succ√®s, switch dans le header.

_Voir `app/(main)/TP3-forms/formik/` et `app/(main)/TP3-forms/rhf/`._


**Sch√©ma d‚Äôarborescence `app/`**
<p align="center">
  <img src="./docs/tp3-arborescence.png" alt="Arborescence app TP3" width="220" />
</p>


---

**Routes principales**

| Nom                | URL / pattern                        | Description                                 |
|--------------------|--------------------------------------|---------------------------------------------|
| Accueil            | `/`                                  | Page d'accueil principale                   |
| TP1 Profile Card   | `/tp1-profile-card`                  | TP1 en page unique                          |
| TP3 Formik         | `/TP3-forms/formik`                  | Formulaire avanc√© (Formik + Yup)            |
| TP3 RHF            | `/TP3-forms/rhf`                     | Formulaire avanc√© (React Hook Form + Zod)   |
| D√©tail             | `/detail/[id]`                       | D√©tail d'un √©l√©ment                         |

---

**Choix techniques**

- **Expo + React Native** : base du projet, rapidit√© de prototypage.
- **expo-router** : navigation par fichiers, gestion avanc√©e des routes et groupes.
- **Formik + Yup** : gestion de formulaire classique, validation d√©clarative.
- **React Hook Form + Zod** : gestion de formulaire moderne, typage strict, validation performante.
- **AsyncStorage** : persistance de la derni√®re route visit√©e.
- **Haptique** : feedback utilisateur natif lors des actions importantes.
- **Factorisation** : composants de champ r√©utilisables (`FormTextInput`, `TermsSwitch`), sch√©mas de validation isol√©s.
- **Aucune logique m√©tier dans les layouts** : seuls les √©crans principaux g√®rent la logique, les layouts ne font que du routage/navigation.

---
**Captures**

| Formik ‚Äî vide | Formik ‚Äî valide | Formik ‚Äî apr√®s envoi |
|---|---|---|
| <img src="./docs/captures/FORMIK.PNG" width="220" /> | <img src="./docs/captures/FORMIK_GOOD.PNG" width="220" /> | <img src="./docs/captures/FORMIK_SEND.PNG" width="220" /> |

| RHF ‚Äî formulaire | Accueil |
|---|---|
| <img src="./docs/captures/RHF.PNG" width="220" /> | <img src="./docs/captures/HOME.PNG" width="220" /> |

---

## 4Ô∏è‚É£ TP4A ‚Äì Robots (CRUD + Zustand)

**Choix de stack formulaire**

- Stack : React Hook Form (RHF) + Zod
- Pourquoi ? RHF = performant et simple (peu de re-rendus). Zod = sch√©mas typ√©s, validation claire et r√©utilisable.

---

**Sch√©ma d‚Äôarborescence**

```
app/(main)/tp4-robots/
  index.tsx            # Liste des robots
  create.tsx           # Cr√©ation
  edit/[id].tsx        # √âdition
app/tp4-robots-zustand/
  store/
    robotsStore.ts       # Zustand : state + actions (CRUD) + persistance
  validation/
    robotSchema.ts       # Zod : sch√©ma de validation
  types/
    robot.ts             # Types TypeScript pour Robot
  components/
    RobotForm.tsx        # Formulaire r√©utilisable (create/edit)
    RobotListItem.tsx    # Item de liste (nom, type, ann√©e, actions)
```

---

**Routes principales**
- `/tp4-robots` : liste
- `/tp4-robots/create` : cr√©ation
- `/tp4-robots/edit/[id]` : √©dition

---

**R√®gles de validation**
- `name` : string, min 2, unique (pas de doublon dans la collection)
- `label` : string, min 3
- `year` : entier, 1950 ‚â§ year ‚â§ ann√©e courante
- `type` : enum obligatoire (`industrial`, `service`, `medical`, `educational`, `other`)

---

**Persistance Zustand**
- Utilisation du middleware `persist` de Zustand avec `AsyncStorage`.
- Toute modification (create, update, delete) est imm√©diatement persist√©e.
- Les robots restent pr√©sents apr√®s red√©marrage de l‚Äôapplication.

---

**Plan de tests manuels**

- **Create** :
    - Succ√®s ‚Üí nouvel item dans la liste
    - √âchec (name dupliqu√©, year invalide) ‚Üí erreurs affich√©es, pas de cr√©ation
- **Edit** :
    - Charger un robot existant, modifier, sauvegarder ‚Üí retour √† la liste mise √† jour
- **Delete** :
    - Suppression confirm√©e ‚Üí l‚Äôitem dispara√Æt, feedback visuel/haptique
- **Persistance** :
    - Cr√©er 2 robots, red√©marrer l‚Äôapp ‚Üí robots toujours pr√©sents
- **UX** :
    - Clavier ne masque pas le bouton submit
    - Submit d√©sactiv√© tant que formulaire invalide

---

**Captures**

| Liste robots | Cr√©er robot | Modifier robot |
|---|---|---|
| <img src="./docs/captures/TP4/LISTE.PNG" width="220" /> | <img src="./docs/captures/TP4/CREATE.PNG" width="220" /> | <img src="./docs/captures/TP4/EDIT.PNG" width="220" /> |

## 4Ô∏è‚É£ TP4B ‚Äì Robots (CRUD + Redux Toolkit)

**D√©pendances & r√¥les**
| Package                | R√¥le principal                                                                 |
|------------------------|-------------------------------------------------------------------------------|
| @reduxjs/toolkit (RTK) | State management, reducers, actions, slices                                   |
| react-redux            | Liaison React <-> Redux (hooks, Provider)                                     |
| redux-persist          | Persistance du state Redux (AsyncStorage)                                     |

---

**Arborescence**
```
app/(main)/tp4-robots-rtk/
  index.tsx            # Liste des robots
  create.tsx           # Cr√©ation
  edit/[id].tsx        # √âdition
  _layout.tsx          # Stack navigation
app/tp4-robots-rtk/
  store.ts             # Store Redux + persistance
  rootReducer.ts       # combineReducers
  robots/robotsSlice.ts# Slice robots (CRUD)
  robots/selectors.ts  # Selecteurs
  hooks.ts             # Typed hooks
  validation/robotSchema.ts # Zod : sch√©ma de validation
  components/RobotForm.tsx  # Formulaire r√©utilisable
```
**Routes principales**
- `/tp4-robots-rtk` : liste
- `/tp4-robots-rtk/create` : cr√©ation
- `/tp4-robots-rtk/edit/[id]` : √©dition

---

**R√®gles de validation**
- `name` : string, min 2, unique (pas de doublon)
- `label` : string, min 3
- `year` : entier, 1950 ‚â§ year ‚â§ ann√©e courante
- `type` : enum obligatoire (`industrial`, `service`, `medical`, `educational`, `other`)

---

**Choix de stack formulaire**
- **Formik** + Zod
- **Justification**‚ÄØ: Il est plus simple √† int√©grer et pour faire l'autre solution que pour le TP4-A

---

**Plan de tests manuels ex√©cut√©s**
- **Create** :
  - Succ√®s ‚Üí nouvel item dans la liste
  - √âchec (name dupliqu√©, year invalide) ‚Üí erreurs affich√©es, pas de cr√©ation
- **Edit** :
  - Charger un robot existant, modifier, sauvegarder ‚Üí retour √† la liste mise √† jour
- **Delete** :
  - Suppression confirm√©e ‚Üí l‚Äôitem dispara√Æt, feedback visuel/haptique
- **Persistance** :
  - Cr√©er 2 robots, red√©marrer l‚Äôapp ‚Üí robots toujours pr√©sents
- **UX** :
  - Clavier ne masque pas le bouton submit
  - Submit d√©sactiv√© tant que formulaire invalide

## 5Ô∏è‚É£ TP5 ‚Äì Robots (SQLite, offline)
**D√©pendances principales**
| Package             | R√¥le principal                                                                                  |
|---------------------|------------------------------------------------------------------------------------------------|
| **expo-sqlite**     | Fournit une base de donn√©es SQLite locale pour stocker et requ√™ter les robots (CRUD, migrations)|
| **expo-file-system**| Permet d‚Äôexporter et d‚Äôimporter les donn√©es robots au format JSON dans le stockage local        |
| **uuid**            | G√©n√®re des identifiants uniques (UUID) pour chaque robot                                        |
| **Formik + Yup**    | G√®rent les formulaires et la validation c√¥t√© client                              |
| **@tanstack/react-query** (optionnel) | G√®re le cache, l‚Äôinvalidation et la synchronisation automatique des donn√©es robots |

---
**Migrations et strat√©gie de version**

- **Migrations SQL**‚ÄØ:  
  Les scripts de migration sont dans `app/tp5-robots-db/db/migrations/`‚ÄØ:
  - `001_init.sql` : cr√©ation de la table robots (v1)
  - `002_add_indexes.sql` : ajout d‚Äôindex pour acc√©l√©rer les requ√™tes (v2)
  - `003_add_archived.sql` : ajout d‚Äôun champ `archived` (v3)
- **Strat√©gie**‚ÄØ:  
  √Ä chaque lancement, la version de la base est v√©rifi√©e‚ÄØ:  
  - Si la DB est en v1, on applique v2 puis v3.
  - Les migrations sont **idempotentes**‚ÄØ: aucun risque de perte de donn√©es.
  - Test√©‚ÄØ: d√©marrage en v1, puis application successive de v2 et v3 ‚Üí la DB est √† jour, les robots existants sont conserv√©s.
---
**Architecture dossier**

```
app/(main)/tp5-robots-db/
  index.tsx            # Liste des robots
  create.tsx           # Cr√©ation
  edit/[id].tsx        # √âdition
  _layout.tsx          # Stack navigation
app/tp5-robots-db/
  db/
    index.ts           # Connexion, migrations, helpers SQL
    migrations/        # Scripts SQL versionn√©s
  hooks/useRobotQueries.ts # Hooks React Query (CRUD)
  services/robotRepo.ts    # Acc√®s bas niveau √† la DB (CRUD)
  utils/                 # Utilitaires (export/import JSON)
```
---
**Plan de tests manuels ex√©cut√©s**

- **Migrations**‚ÄØ:  
  - D√©marrer en v1, appliquer v2 puis v3 ‚Üí la DB est √† jour, aucune perte de robots.
- **CRUD complet**‚ÄØ:  
  - Cr√©er un robot ‚Üí il appara√Æt dans la liste.
  - Modifier un robot ‚Üí les changements sont visibles.
  - Supprimer un robot ‚Üí il dispara√Æt de la liste.
- **Persistance**‚ÄØ:  
  - Cr√©er plusieurs robots, red√©marrer l‚Äôapp ‚Üí les robots sont toujours pr√©sents.
- **Export**‚ÄØ:  
  - Exporter les robots ‚Üí un fichier JSON est g√©n√©r√©, sa taille et son contenu correspondent √† la liste.
- **(Bonus) Import**‚ÄØ:  
  - Importer un fichier JSON export√© ‚Üí les robots sont recharg√©s dans l‚Äôapp.
- **UX**‚ÄØ:  
  - Clavier ne masque pas le bouton submit (KeyboardAvoidingView).
  - Spinner affich√© pendant les requ√™tes longues.
  - Erreurs claires (unicit√©, ann√©e, etc.).
  - L‚ÄôUI reste r√©active (API async).
---
**Captures d‚Äô√©cran**

| Liste des robots | Export JSON | Import JSON |
|---|---|---|
| ![Liste](./docs/captures/TP5/LISTE.PNG) | ![Export](./docs/captures/TP5/EXPORT.jpg) | ![Import](./docs/captures/TP5/IMPORT.PNG) |

---

## 6Ô∏è‚É£ TP6 ‚Äì Cam√©ra & Galerie locale

**D√©pendances**

| Package             | R√¥le principal                                                                 |
|---------------------|-------------------------------------------------------------------------------|
| expo-camera         | Acc√®s √† la cam√©ra, pr√©visualisation et capture de photos                      |
| expo-file-system    | Stockage, lecture, suppression de fichiers locaux dans l‚Äôapp                  |
| expo-media-library* | (Optionnel) Sauvegarde dans la galerie syst√®me (Photos)                      |

---
**Arborescence**

```
app/(main)/TP6-camera/
  index.tsx            # Galerie (liste des miniatures)
  camera.tsx           # √âcran de prise de vue
  detail/[id].tsx      # √âcran D√©tail (afficher, supprimer‚Ä¶)
  lib/
    camera/
      storage.ts       # Fonctions: savePhoto, listPhotos, getPhoto, deletePhoto
      types.ts         # Type Photo: { id, uri, createdAt, size? }
    hooks/
      useCameraPermission.ts
      usePhotoStorage.ts  # (optionnel)
```

---
**Permissions**
- iOS : Ajoutez `NSCameraUsageDescription` dans `app.json`.
- Android : Permission `CAMERA` (Expo g√®re souvent cela automatiquement).
- Demande au runtime via hook `useCameraPermission` √† l‚Äôentr√©e de l‚Äô√©cran Cam√©ra.
- En cas de refus : UI explicite + bouton ‚ÄúOuvrir les r√©glages‚Äù.

---
**Flux principal**
1. Galerie : liste les photos locales (grille de miniatures, bouton "Prendre une photo").
2. Cam√©ra : preview, capture, enregistrement local via `expo-file-system` (dossier `photos/`).
3. Apr√®s capture : retour automatique √† la galerie avec feedback.
4. D√©tail : affiche la photo, m√©tadonn√©es, actions (supprimer, partager‚Ä¶).
5. Suppression : retire le fichier + retour galerie.
6. Persistance : les photos restent apr√®s red√©marrage de l‚Äôapp.
---
**Plan de tests manuels**
1. Permissions : refuser ‚Üí UI explicite ; accepter ‚Üí cam√©ra OK.
2. Capture : prendre 2 photos ‚Üí revenir Galerie ‚Üí les 2 miniatures visibles.
3. D√©tail : ouvrir une photo ‚Üí afficher m√©tadonn√©es.
4. Suppression : supprimer une photo ‚Üí retour Galerie ‚Üí miniature disparue ‚Üí le fichier n‚Äôexiste plus.
5. Persistance : red√©marrer l‚Äôapp ‚Üí les photos sont toujours list√©es.
6. (Optionnel) Partage ou Enregistrement dans la galerie syst√®me : v√©rifier le r√©sultat.
---
**Captures d‚Äô√©cran**
| Galerie | Cam√©ra | D√©tail |
|---|---|---|
| ![Galerie](./docs/captures/TP6/GALERIE.PNG) | ![Cam√©ra](./docs/captures/TP6/CAMERA.PNG) | ![D√©tail](./docs/captures/TP6/DETAIL.PNG) |
